<div class="flex flex-col md:min-w-128  -m-6">

    <!-- Header -->
    <div class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary">
        <div class="text-lg font-medium  text-white">Installments</div>
        <div class="flex flex-row gap-3">
            <mat-form-field class="fuse-mat-dense fuse-mat-rounded min-w-64 rounded-3xl bg-[#1e293b]"
                [subscriptSizing]="'dynamic'">
                <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                <input matInput [formControl]="searchInputControl" [autocomplete]="'off'" [placeholder]="'Search'" />
            </mat-form-field>
            <button mat-flat-button [color]="'primary'" (click)="create()">
                <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                <span class="ml-2 mr-1">Add</span>
            </button>
            <button mat-icon-button (click)="matDialogRef.close()" [tabIndex]="-1">
                <mat-icon class="text-current text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </button>
        </div>
    </div>

    <div class="overflow-auto h-[350px]">
        <table class="h-fit bg-transparent min-w-[1000px] w-full" mat-table [dataSource]="dataSource" matSort
            matSortDisableClear (matSortChange)="refreshItems()">
            <ng-container matColumnDef="{{ element.key }}" *ngFor="let element of columns" [sticky]="element.is_sticky">
                <th mat-header-cell *matHeaderCellDef class="w-{{ element.width }} text-{{
                    element.align
                }} table-header-{{ element.align }}">
                    <span *ngIf="element.is_sortable" [mat-sort-header]="element.key">{{ element.name }}</span>
                    <span *ngIf="!element.is_sortable">{{ element.name }}</span>
                </th>
                <div *ngIf="element.key !== 'actions'">
                    <td mat-cell *matCellDef="let row" class="truncate w-{{ element.width }} text-{{
                        element.align
                    }}" [ngClass]="element.is_included ? 'max-w-20' : ''">
                        <span *ngIf="
                            !element.indicator &&
                            !element.is_required &&
                            !element.is_included &&
                            !element.is_boolean
                        " class="pr-4">{{
                            element.is_date
                            ? (row[element.key]
                            | date : element.date_formate)
                            : row[element.key]
                            }}</span>

                        <div *ngIf="element.indicator" class="flex flex-row space-x-2 items-center">
                            <div *ngIf="row['is_payment_audited']" class="h-2 w-2 rounded-full bg-green-600"
                                [matTooltip]="'Audited'"></div>
                            <span class="flex flex-col">{{
                                element.is_date
                                ? (row[element.key]
                                | date : element.date_formate)
                                : row[element.key]
                                }}
                                <span *ngIf="row['is_wl_expired']" class="text-red-500 text-xs leading-none">
                                    Expired
                                </span>
                            </span>
                        </div>

                        <span *ngIf="element.is_required">{{
                            row[element.key] ? "Yes" : "No"
                            }}</span>
                        <span *ngIf="element.is_included" class="truncate max-w-20"
                            [matTooltip]="row[element.key]">{{row[element.key]}}</span>
                    </td>
                </div>

                <div *ngIf="element.key === 'actions'">
                    <td mat-cell *matCellDef="let row" [ngClass]="row.is_disabled ? 'opacity-38' : ''" class="dark bg-[#1e293b] truncate w-{{ element.width }} text-{{
                        element.align
                    }}">
                        <mat-icon class="cursor-pointer relative top-1"
                            [matMenuTriggerFor]="row.is_payment_audited ? null : menuOpt">more_vert</mat-icon>
                        <mat-menu #menuOpt>
                            <button mat-menu-item (click)="edit(row)">
                                <mat-icon class="mat-18">edit</mat-icon>
                                <span style="font-weight: 600">Edit</span>
                            </button>
                            <button mat-menu-item (click)="delete(row)">
                                <mat-icon class="mat-18">delete</mat-icon>
                                <span style="font-weight: 600">Delete</span>
                            </button>
                            <mat-divider></mat-divider>
                            <button mat-menu-item (click)="Payment(row)">
                                <mat-icon svgIcon="money"></mat-icon>
                                <span style="font-weight: 600">Payment</span>
                            </button>
                            <button mat-menu-item (click)="Audit(row)"
                                *ngIf="row.payment_date && !row.is_payment_audited">
                                <mat-icon class="mat-18">check_circle</mat-icon>
                                <span style="font-weight: 600">Audit</span>
                            </button>
                        </mat-menu>
                    </td>
                </div>
            </ng-container>

            <tr class="sticky top-0 z-10" mat-header-row *matHeaderRowDef="cols"></tr>
            <tr mat-row *matRowDef="let row; columns: cols"></tr>
        </table>
        <div class="flex-grow flex flex-row items-center min-h-40 justify-center" *ngIf="dataSource.data.length < 1">
            <div>
                <span class="text-secondary font-semibold text-xl">{{
                    getNodataText()
                    }}</span>
            </div>
        </div>
    </div>
   
    <mat-paginator class="border-b sm:border-t sm:border-b-0" [pageSizeOptions]="appConfig.pageSizeOptions"
        [pageSize]="appConfig.pageSize" (page)="refreshItems()" [showFirstLastButtons]="appConfig.showFirstLastButtons">
    </mat-paginator>
</div>