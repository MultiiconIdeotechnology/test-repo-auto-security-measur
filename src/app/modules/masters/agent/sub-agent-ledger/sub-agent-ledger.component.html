<div>

    <div class="flex flex-row gap-3">


        <div class="flex flex-row gap-4  items-center w-full ">

            <!-- <mat-form-field class=" justify-center items-center  w-full">
                <mat-icon class="icon-size-5 !light-text" matPrefix
                    [svgIcon]="'heroicons_outline:magnifying-glass'"></mat-icon>
                <input [formControl]="searchInputControl" [readOnly]="loading" matInput class="text-md !light-text"
                    [autocomplete]="'off'" [placeholder]="'Search'" />
            </mat-form-field> -->


            <div class="flex ctm_search mb-4 w-full">
                <input matInput class="w-[96%]" [formControl]="searchInputControl" [autocomplete]="'off'" [placeholder]="'Search'"/>
                <mat-icon class="icon-size-5 " matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
            </div>

            <div class="flex flex-row gap-4  flex-1 mb-5">
                <mat-form-field class="w-60 bottom_none">
                    <mat-select [formControl]="id" #serviceo (selectionChange)="refreshItems()">
                        <mat-option>
                            <ngx-mat-select-search placeholderLabel="Search"
                                noEntriesFoundLabel="'no matching agent found'" [formControl]="agentfilter">
                            </ngx-mat-select-search>
                        </mat-option>
                        <mat-option *ngFor="let ct of agentList" [value]="ct.id">
                            <span><span *ngIf="ct.code">{{ ct.code }} - </span>{{ ct.agency_name }}<span
                                    *ngIf="ct.master_agent_name"> ({{ ct.master_agent_name }})</span></span>
                            <div class="-mt-2">
                                <span class="text-secondary text-sm">{{
                                    ct.email_address
                                    }}</span>
                            </div>
                        </mat-option>
                    </mat-select>
                </mat-form-field>

                <div class="justify-center items-center w-60">
                    <div *ngIf="date.value !== DR.setCustomDate" class="w-full flex flex-row justify-between">
                        <mat-form-field class="w-full bottom_none">
                            <mat-select name="date" [formControl]="date" #dateRange
                                (selectionChange)="updateDate($event.value)">
                                <mat-option *ngFor="let dr of dateRanges" [value]="dr">{{
                                    dr
                                    }}</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>

                    <div *ngIf="date.value === DR.setCustomDate" class="w-full flex flex-row items-center space-x-1">
                        <mat-form-field class="w-full bottom_none">
                            <mat-date-range-input [rangePicker]="picker" (click)="onRangeInputClicked()">
                                <input matStartDate [formControl]="startDate" placeholder="Start Date" readonly
                                    #dateRangeStart />
                                <input matEndDate [formControl]="endDate" placeholder="End Date" readonly #dateRangeEnd
                                    (dateInput)="
                                    dateRangeChange(dateRangeStart, dateRangeEnd)
                                " />
                            </mat-date-range-input>
                            <mat-datepicker-toggle #sec matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-date-range-picker #picker></mat-date-range-picker>
                        </mat-form-field>
                        <mat-icon class="icon-size-4 cursor-pointer" (click)="cancleDate()">cancel</mat-icon>
                    </div>
                </div>


            </div>

            <button mat-raised-button [color]="'primary'" [matMenuTriggerFor]="menu" class="w-10 mb-5">
                <mat-icon class="icon-size-6">more_vert</mat-icon>
            </button>
            <mat-menu #menu>
                <button mat-menu-item (click)="exportExcel()">
                    <mat-icon>arrow_downward</mat-icon>
                    <span>Export Excel</span>
                </button>
            </mat-menu>
        </div>
    </div>

    <div class="overflow-auto flex flex-col max-h-[60vh] rounded border">
        <div class="flex flex-col overflow-auto max-w-full "
            [class.hidden]="dataSource.filteredData.length <= 0 && loading">
            <table mat-table [dataSource]="dataSource" class="border-collapse sale-tab" matSort matSortDisableClear
                matSortActive="datetime" matSortDirection="asc" #_sort>

                <ng-container matColumnDef="datetime">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-18 max-w-18" *matHeaderCellDef>
                        Date
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-18 max-w-18 py-2">
                        <div class="flex flex-col">
                            <p class="text-md font-medium leading-4">
                                {{ element.datetime | date : "dd-MM-yyyy" }}
                            </p>
                            <p class="text-xs font-medium text-secondary leading-3">
                                {{ element.datetime | date : "HH:mm" }}
                            </p>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="reference_number">
                    <th mat-header-cell class="font-bold text-md min-w-36 max-w-36" *matHeaderCellDef>
                        Reference Number
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-36 max-w-36 cursor-pointer py-2"
                        (click)="informations(element)">
                        <p class="text-md font-medium truncate pr-1" [matTooltip]="element.reference_number">
                            {{ element.reference_number || " - " }}
                        </p>
                    </td>
                </ng-container>

                <ng-container matColumnDef="particular">
                    <th mat-header-cell class="font-bold text-md      min-w-72 max-w-72" *matHeaderCellDef>
                        Particular
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-72 max-w-72 py-2">
                        <div class="flex flex-col">
                            <p class="text-md font-medium line-clamp-2  pr-1 leading-4"
                                [matTooltip]="element.particular">
                                {{ element.particular || " - " }}
                            </p>
                            <p class="text-sm text-secondary leading-3 pt-2">
                                {{ element.remark }}
                            </p>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="credit">
                    <th mat-header-cell class="font-bold text-md min-w-20 max-w-20" *matHeaderCellDef>
                        <div class="flex justify-end">Credit</div>
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-20 max-w-20 text-right py-2">
                        <p class="text-md font-medium pr-1 truncate "
                            [ngClass]="element.credit > 0 ? 'text-green-500' : ''">
                            {{ element.credit == 0 ? " - " : element.credit }}
                        </p>
                    </td>
                </ng-container>

                <ng-container matColumnDef="debit">
                    <th mat-header-cell class="font-bold text-md min-w-20 max-w-20" *matHeaderCellDef>
                        <div class="flex justify-end">Debit</div>
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-20 max-w-20 text-right py-2">
                        <p class="text-md font-medium pr-1 truncate " [ngClass]="
                                element.debit > 0 ? 'text-red-500' : ''
                            ">
                            {{ element.debit == 0 ? " - " : element.debit }}
                        </p>
                    </td>
                </ng-container>

                <ng-container matColumnDef="balance">
                    <th mat-header-cell class="font-bold text-md min-w-20 max-w-20" *matHeaderCellDef>
                        <div class="flex justify-end">Balance</div>
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-20 text-right py-2 max-w-20">
                        <p class="text-md font-medium ">{{ element.balance }}</p>
                    </td>
                </ng-container>



                <tr class="h-9 min-h-9 sticky top-0 z-10" mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
                <tr class="h-9 border-0 " mat-row *matRowDef="let row; columns: columns"></tr>
            </table>
        </div>
        <div class="flex flex-col justify-center items-center w-full h-80"
            *ngIf="dataSource.filteredData.length <= 0 || loading">
            <div class="flex flex-row items-center space-x-4" *ngIf="loading">
                <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
                <span class="text-xl">Loading...</span>
            </div>
            <div class="flex flex-col items-center justify-center" *ngIf="!loading">
                <!-- <img src="assets/images/wallet/no_data_vector.svg" class="h-44" alt="nodata" /> -->
                <div class="text-secondary flex flex-col justify-center items-center text-md"
                    *ngIf="searchInputControl.value">
                    <span>no search results found for "<b>{{
                            searchInputControl.value
                            }}</b>".</span>
                </div>
            </div>
        </div>
        <mat-paginator class="second-color z-10 sticky w-full bottom-0 " #paginator [pageSizeOptions]="[5, 10, 25, 100]"
            [length]="total" [pageSize]="10" showFirstLastButtons>
        </mat-paginator>
    </div>
</div>