<div class="flex flex-col max-w-240 md:min-w-140 max-h-screen -m-6">

    <!-- Header -->
    <div class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-8 bg-primary">
        <div class="text-lg font-medium text-white">{{title}}</div>
        <button mat-icon-button (click)="matDialogRef.close()" [tabIndex]="-1">
            <mat-icon class="text-current text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
        </button>
    </div>

    <form class="flex flex-col flex-auto px-6 pt-6 overflow-y-auto max-h-120" [formGroup]="formGroup"
        *ngIf="!readonly; else detailView">

        <mat-form-field class="flex-grow">
            <mat-label>Supplier Booking Ref.No</mat-label>
            <input matInput type="text" formControlName="supplier_booking_ref_no" required>
        </mat-form-field>

        <div class="flex flex-row gap-3">
            <mat-form-field class="flex-grow">
                <mat-label>Service Type</mat-label>
                <mat-select required formControlName="service_type">
                    <mat-option *ngFor="let list of serviceList" [value]="list.value">
                        {{ list.viewValue }}
                    </mat-option>
                </mat-select>
            </mat-form-field>

            <mat-form-field class="flex-grow">
                <mat-label>Supplier</mat-label>
                <mat-select formControlName="supplier_id" required (selectionChange)="supplierChange($event.value)"
                    [compareWith]="compareWith">
                    <mat-option>
                        <ngx-mat-select-search placeholderLabel="Search"
                            noEntriesFoundLabel="'no matching product found'" [formControlName]="'supplierFilter'">
                        </ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let ct of SupplierList | async" [value]="ct">{{ct.company_name}}</mat-option>
                </mat-select>
            </mat-form-field>
        </div>

        <div class="flex flex-row gap-3">
            <mat-form-field class="flex-grow">
                <mat-label>Currency</mat-label>
                <input matInput type="text" formControlName="currency" required readonly>
            </mat-form-field>

            <mat-form-field class="flex-grow">
                <mat-label>ROE</mat-label>
                <input matInput type="number" formControlName="roe" required>
            </mat-form-field>
        </div>

        <div class="flex flex-row gap-3">
            <mat-form-field class="flex-grow w-1/2">
                <mat-label>Service Date</mat-label>
                <input matInput readonly [matDatepicker]="picker1" required formControlName="service_date">
                <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
                <mat-datepicker #picker1></mat-datepicker>
            </mat-form-field>

            <mat-form-field class="flex-grow w-1/2">
                <mat-label>Purchase Amount</mat-label>
                <input matInput type="number" formControlName="purchase_amount" required>
            </mat-form-field>
        </div>

        <mat-form-field class="flex-grow">
            <mat-label>Service Particular</mat-label>
            <textarea matInput formControlName="service_particular" required></textarea>
        </mat-form-field>

        <mat-form-field class="flex-grow">
            <mat-label>Service Remark</mat-label>
            <textarea matInput formControlName="service_remark" required></textarea>
        </mat-form-field>

        <div
            class="flex dark:bg-gray-700 bg-gray-200 min-h-[65px] items-center px-4 mb-3 my-2 second-color justify-between shadow rounded-xl overflow-hidden">
            <div class="flex flex-row items-center w-full justify-between overflow-hidden">
                <div class="py-4 flex flex-row items-center gap-3 second-color  overflow-hidden">
                    <span class="text-lg truncate">
                        Invoice
                    </span>
                </div>

                <div class="flex flex-row items-end justify-center space-x-1">
                    <button mat-icon-button [matTooltip]="'Download'" (click)="download()"
                        [disabled]="!formGroup.get('supplier_invoice').value">
                        <mat-icon class="icon-size-6"
                            [ngClass]="formGroup.get('supplier_invoice').value ? 'text-primary':''"
                            [svgIcon]="'heroicons_outline:download'"></mat-icon>
                    </button>
                    <div [hidden]="true">
                        <input type="file" name="documentUpload" #document (change)="uploadDocument($event)">
                    </div>
                    <button (click)="document.click()" [matTooltip]="'Upload'" mat-icon-button>
                        <mat-icon class="icon-size-6" [svgIcon]="'heroicons_outline:upload'"></mat-icon>
                    </button>
                </div>
            </div>
        </div>

    </form>

    <ng-template #detailView>
        <div class="grid grid-cols-4 gap-4 p-6 pb-4 bg-card rounded-2xl overflow-hidden min-w-180">
            <div class="flex flex-col mb-3" *ngFor="let filed of fieldList">
                <div class="flex flex-row space-x-2">
                    <span class="text-md font-semibold text-secondary">{{
                        filed.name
                        }}</span>
                    <mat-icon *ngIf="filed.show_info" [matTooltip]="filed.info_tooltip">info</mat-icon>
                </div>
                <span class="truncate flex items-center">
                    <span class="text-base truncate"
                        *ngIf="filed.name === 'Logo size 1' || filed.name === 'Logo size 2' || filed.name === 'Logo size 3'">
                        <img *ngIf="filed.value" class="w-13  object-cover cursor-pointer" src={{filed.value}}>
                        <span *ngIf="!filed.value">--</span>
                    </span>
                    <span class="text-base truncate" [matTooltip]="filed.value"
                        *ngIf="filed.name !== 'Logo size 1' && filed.name !== 'Logo size 2' && filed.name !== 'Logo size 3' ">{{
                        filed.value || "--" }}</span>
                </span>

            </div>
        </div>
    </ng-template>

    <div class="flex items-center justify-end mt-4 sm:mt-0 pr-6 pt-4 pb-4 space-x-3">
        <button mat-flat-button [color]="'primary'" (click)="submit()" *ngIf="!readonly" [disabled]="disableBtn">
            {{btnLabel}}
        </button>
    </div>
</div>