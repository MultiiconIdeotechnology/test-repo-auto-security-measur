
<div class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden  dark:bg-transparent">
    <!-- Header -->
    <div
        class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-4 px-6 md:px-8 border-b">
        <!-- Title -->
        <div class="text-3xl font-extrabold tracking-tight">
            {{ module_name }}
        </div>
        <!-- Actions -->
        <div class="flex shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
            <!-- Search -->

            <mat-form-field class="fuse-mat-dense fuse-mat-rounded min-w-64" [subscriptSizing]="'dynamic'">
                <mat-icon class="icon-size-5 " matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                <input matInput [formControl]="searchInputControl" [autocomplete]="'off'" [placeholder]="'Search'" />
            </mat-form-field>
            <!-- Add product button -->
            <!-- <button class="ml-4" mat-flat-button [color]="'primary'" (click)="create()">
                <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                <span class="ml-2 mr-1">Add</span>
            </button> -->

            <button class="ml-4" mat-flat-button [color]="'primary'" (click)="filter()">
                <mat-icon class="w-10 h-10">filter_alt</mat-icon>
                <span class="">Filter</span>
            </button>

            <button class="ml-4" mat-flat-button [disabled]="isLoading" (click)="refreshItems()" [color]="'primary'">
                <mat-icon class="icon-size-4.5" svgIcon="feather:refresh-ccw"></mat-icon>
            </button>

            <button mat-raised-button [color]="'primary'" [matMenuTriggerFor]="menu" class="ml-4">
                <mat-icon class="icon-size-6">more_vert</mat-icon>
            </button>
            <mat-menu #menu>
                <button mat-menu-item (click)="exportExcel()">
                    <mat-icon>arrow_downward</mat-icon>
                    <span>Export Excel</span>
                </button>
                <button mat-menu-item (click)="reShuffle()">
                    <mat-icon svgIcon="heroicons_outline:arrows-right-left"></mat-icon>
                    <span style="font-weight: 600">Reshuffle</span>
                </button>
            </mat-menu>
        </div>
    </div>

    <div class="flex flex-col flex-auto overflow-hidden">
        <!-- list -->
        <div class="flex flex-col flex-auto sm:mb-18 overflow-hidden overflow-y-auto overflow-x-auto max-sm:pb-15">
            <ng-container>
                <div class="grid">
                    <!-- Header -->
                    <div class="tbl-grid gridwidth z-10 sticky top-0 grid   py-2 px-6 md:pr-8 pl-0 shadow text-md font-semibold bg-card"
                        matSort matSortDisableClear (matSortChange)="refreshItems()">
                        <div style="text-align: center" class="sticky left-0 bg-card z-99">
                            #
                        </div>

                        <ng-container *ngFor="let col of columns">
                            <div *ngIf="col.is_sortable" [mat-sort-header]="col.key" [class]="'pl-4 ' + col.class" [ngClass]="col.is_fixed ? 'z-99 sticky left-10 dark:bg-card bg-white': ''">
                                {{ col.name }}
                            </div>
                            <div *ngIf="!col.is_sortable" [class]="'pl-4 ' + col.class" [ngClass]="col.is_fixed ? 'z-99 sticky left-10 dark:bg-card bg-white': ''">
                                {{ col.name }}
                            </div>
                        </ng-container>
                    </div>
                    <!-- Rows -->
                    <ng-container *ngIf="dataList.length > 0; else noGridItems">
                        <ng-container *ngFor="let ListItem of dataList">
                            <div
                                class="tbl-grid gridwidth grid items-center   px-6 md:pr-8 border-b pl-0 cursor-pointer">
                                <button mat-icon-button (click)="$event.stopPropagation()"
                                    [matMenuTriggerFor]="optionMenu" class="sticky left-0 bg-gray-50 dark:bg-gray-900"
                                    style="border-radius: 0%; width: 100%">
                                    <mat-icon> more_vert </mat-icon>
                                </button>
                                <mat-menu #optionMenu>
                                    <button mat-menu-item (click)="view(ListItem)">
                                        <mat-icon class="mat-18">info</mat-icon>
                                        <span style="font-weight: 600">Info</span>
                                    </button>
                                    <button mat-menu-item (click)="edit(ListItem)">
                                        <mat-icon class="mat-18">edit</mat-icon>
                                        <span style="font-weight: 600">Edit</span>
                                    </button>
                                    <!-- <button mat-menu-item (click)="delete(ListItem)">
                                        <mat-icon class="mat-18">delete</mat-icon>
                                        <span style="font-weight: 600">Delete</span>
                                    </button> -->
                                    <mat-divider></mat-divider>
                                    <button mat-menu-item (click)="statusChangedLog(ListItem)">
                                        <mat-icon class="mat-18">event_note</mat-icon>
                                        <span style="font-weight: 600">Status Changed Log</span>
                                    </button>
                                    <button mat-menu-item (click)="setKYCVerify(ListItem)">
                                        <mat-icon class="mat-18">fingerprint</mat-icon>
                                        <span style="font-weight: 600">{{
                                            ListItem["is_kyc_completed"]
                                            ? "View KYC"
                                            : "Verify KYC"
                                            }}</span>
                                    </button>
                                    <!-- <button mat-menu-item>
                                        <mat-icon class="mat-18">login</mat-icon>
                                        <span style="font-weight: 600">Agent Login</span>
                                    </button> -->
                                    <button mat-menu-item (click)="setMarkupProfile(ListItem)">
                                        <mat-icon class="mat-18">person</mat-icon>
                                        <span style="font-weight: 600">Set Markup Profile</span>
                                    </button>
                                    <!-- <button mat-menu-item (click)="kycProfile(ListItem)">
                                        <mat-icon class="mat-18">beenhere</mat-icon>
                                        <span style="font-weight: 600">Set KYC Profile</span>
                                    </button> -->
                                    <button mat-menu-item (click)="autologin(ListItem)">
                                        <mat-icon class="mat-18">login</mat-icon>
                                        <span style="font-weight: 600">Auto Login to B2B</span>
                                    </button>
                                    <mat-divider></mat-divider>
                                    <button mat-menu-item (click)="setBlockUnblock(ListItem)">
                                        <mat-icon class="mat-18">{{
                                            ListItem.is_blocked
                                            ? "highlight_off"
                                            : "check_circle"
                                            }}</mat-icon>
                                        <span style="font-weight: 600">{{
                                            ListItem.is_blocked
                                            ? "Unblock"
                                            : "Block"
                                            }}</span>
                                    </button>
                                    <!-- <button mat-menu-item (click)="resetPassword(ListItem)">
                                        <mat-icon class="mat-18">lock</mat-icon>
                                        <span style="font-weight: 600">Reset Password</span>
                                    </button> -->
                                    <button *ngIf="!ListItem.is_email_verified" mat-menu-item
                                        (click)="setEmailVerify(ListItem)">
                                        <mat-icon class="mat-18">verified</mat-icon>
                                        <span style="font-weight: 600">Verify Email</span>
                                    </button>
                                    <button *ngIf="!ListItem.is_mobile_verified" mat-menu-item
                                        (click)="setMobileVerify(ListItem)">
                                        <mat-icon class="mat-18">verified</mat-icon>
                                        <span style="font-weight: 600">Verify Mobile</span>
                                    </button>
                                    <button mat-menu-item (click)="setCurrency(ListItem)">
                                        <mat-icon [svgIcon]="
                                                'heroicons_outline:currency-rupee'
                                            "></mat-icon>
                                        <span style="font-weight: 600">Set Currency</span>
                                    </button>
                                    <button mat-menu-item *ngIf="!ListItem.is_wl" (click)="convertWl(ListItem)">
                                        <mat-icon class="mat-18">sync_alt</mat-icon>
                                        <span style="font-weight: 600">Convert to WL</span>
                                    </button>
                                    <button mat-menu-item (click)="resetPassword(ListItem)">
                                        <mat-icon class="mat-18">lock</mat-icon>
                                        <span style="font-weight: 600;">Reset Password</span>
                                    </button>
                                    <button mat-menu-item (click)="wallettransfer(ListItem)">
                                        <mat-icon class="mat-18">sync_alt</mat-icon>
                                        <span style="font-weight: 600">Wallet Transfer</span>
                                    </button>
                                    <mat-divider></mat-divider>
                                    <button mat-menu-item (click)="relationahipManager(ListItem)">
                                        <mat-icon class="mat-18">groups</mat-icon>
                                        <span style="font-weight: 600">Relationship Manager</span>
                                    </button>
                                    <button mat-menu-item (click)="relationahipManagerLog(ListItem)">
                                        <mat-icon class="mat-18">groups</mat-icon>
                                        <span style="font-weight: 600">Relationship Manager Log</span>
                                    </button>
                                </mat-menu>

                                <ng-container *ngFor="let col of columns">
                                    <div [class]="
                                            'flex flex-row items-center space-x-2 truncate pl-4 ' +
                                            col.class
                                        " [ngClass]="col.is_fixed ? 'sticky left-10 dark:dark bg-[#f1f5f9]': ''">

                                        <div *ngIf="col.indicator" [matTooltip]="
                                                ListItem['is_kyc_completed']
                                                    ? 'KYC Complete'
                                                    : 'KYC Pending'
                                            " class="w-2 h-2 rounded-full" [ngClass]="
                                                ListItem['is_kyc_completed']
                                                    ? 'bg-green-500'
                                                    : 'bg-red-500'
                                            "></div>

                                        <mat-icon class="text-green-600 icon-size-4 " [matTooltip]="'Verified'"
                                            *ngIf="
                                                ListItem[
                                                    'is_mobile_verified'
                                                ] && col.key === 'mobile_number'
                                            ">verified</mat-icon>
                                        <mat-icon class="text-yellow-600 icon-size-4 " [matTooltip]="
                                                'Verification Pending'
                                            " *ngIf="
                                                !ListItem[
                                                    'is_mobile_verified'
                                                ] && col.key === 'mobile_number'
                                            ">warning</mat-icon>

                                        <mat-icon class="text-green-600 icon-size-4 " [matTooltip]="'Verified'"
                                            *ngIf="
                                                ListItem['is_email_verified'] &&
                                                col.key === 'email_address'
                                            ">verified</mat-icon>
                                        <mat-icon class="text-yellow-600 icon-size-4 " [matTooltip]="
                                                'Verification Pending'
                                            " *ngIf="
                                                !ListItem[
                                                    'is_email_verified'
                                                ] && col.key === 'email_address'
                                            ">warning</mat-icon>

                                        <div class="flex flex-col truncate">
                                            <span class="truncate" [matTooltip]="col.tooltip ? ListItem[col.key] : ''">
                                                {{col.is_date ? ((ListItem[col.key] | date: col.date_formate) || ' - ')
                                                :
                                                ListItem[col.key] || ' - '}}
                                            </span>
                                            <span class="text-red-500 text-xs" *ngIf="
                                                    col.key === 'agency_name' &&
                                                    ListItem['is_blocked']
                                                ">
                                                Blocked
                                            </span>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-container>
                    </ng-container>
                </div>
            </ng-container>

            <ng-template #noGridItems>
                <div class="p-8 sm:p-16 border-t text-3xl tracking-tight text-center pt-20">
                    {{ getNodataText() }}
                </div>
            </ng-template>
        </div>

        <mat-paginator
            class="sm:absolute sm:inset-x-0 sm:bottom-0 border-b sm:border-t sm:border-b-0 max-sm:bottom-0 max-sm:fixed max-sm:inset-x-0 z-10 bg-white dark:bg-gray-900 dark:bg-opacity-5"
            [ngClass]="{ 'pointer-events-none': isLoading }" [length]="total"
            [pageSizeOptions]="appConfig.pageSizeOptions" [pageSize]="appConfig.pageSize" (page)="refreshItems()"
            [showFirstLastButtons]="appConfig.showFirstLastButtons">
        </mat-paginator>
    </div>
</div>
