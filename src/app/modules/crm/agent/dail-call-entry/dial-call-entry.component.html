<div class="flex flex-col flex-auto overflow-hidden bg-card shadow rounded-2xl -m-6 min-w-160 max-w-160">
    <div class="flex flex-0 items-center justify-between h-16 pr-3 sm:pr-5 pl-6 sm:pl-4 bg-primary">
        <div class="text-lg font-medium text-white">{{title}}</div>
        <button mat-icon-button (click)="matDialogRef.close()" [tabIndex]="-1">
            <mat-icon class="text-current text-white" [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
        </button>
    </div>
    <div class="xl:min-h-[490px] xl:max-h-[490px] min-h-[400px] max-h-[400px] overflow-y-auto">
        <div class="flex flex-raw overflow-hidden overflow-x-auto border rounded-[10px] m-4">
            <div class="w-[100%] px-4 field-blue-bg dark:bg-[#2A374A] bg-gray-200 ">
                <div class="grid py-2 xl:grid-cols-3 grid-cols-3 gap-4 overflow-hidden">
                    <div class="flex flex-col">
                        <span class="text-base font-medium text-secondary dark:text-[#687798]">Agency Name</span>
                        <span class="text-[15px] truncate dark:text-white text-black"
                            [matTooltip]="record?.agencyName">{{record?.agencyName ? record?.agencyName : "
                            -"}}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-base font-medium text-secondary dark:text-[#687798]">Contact Person</span>
                        <div class="text-base truncate">
                            <span class="text-[15px] truncate dark:text-white text-black"
                                [matTooltip]="record?.contactPerson">{{record?.contactPerson ?
                                record?.contactPerson : '-'}}</span>
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-base font-medium text-secondary dark:text-[#687798]">Mobile Number</span>
                        <span class="text-[15px] truncate dark:text-white text-black"
                            [matTooltip]="record?.contactPersonMobileCode ? '+' + record?.contactPersonMobileCode + ' ' + record?.mobileNumber : (record?.mobileNumber ? record?.mobileNumber : '-')">
                            {{ record?.contactPersonMobileCode ? '+' + record?.contactPersonMobileCode : '' }}
                            {{ record?.mobileNumber ? record?.mobileNumber : '-' }}
                        </span>
                    </div>
                </div>
                <div class="grid py-2 xl:grid-cols-3 grid-cols-3 gap-4 overflow-hidden">
                    <div class="flex flex-col">
                        <span class="text-base font-medium  text-secondary dark:text-[#687798]">Email Address</span>
                        <span class="text-[15px] truncate dark:text-white text-black"
                            [matTooltip]="record?.emailAddress">{{record?.emailAddress ?
                            record?.emailAddress : '-'}}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-base font-medium text-secondary dark:text-[#687798]">Last Call Date</span>
                        <span class="text-[15px] truncate dark:text-white text-black"
                            [matTooltip]="record?.lastCallDate">{{(record?.lastCallDate |
                            date:'dd-MM-yyyy') || ' - '}}</span>
                    </div>
                    <div class="flex flex-col">
                        <span class="text-base font-medium text-secondary dark:text-[#687798]">Last Feedback</span>
                        <span class="text-[15px] truncate dark:text-white text-black">{{record?.lastFeedback ?
                            record?.lastFeedback : '-'}}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="flex flex-raw overflow-hidden overflow-x-auto rounded-[10px] m-2">
            <div class="w-full">
                <form class="flex flex-col flex-auto overflow-hidden" [formGroup]="formGroup">
                    <div class="pt-2">
                        <div class="flex flex-row w-full">
                            <div class="flex flex-row w-full">
                                <div class="w-1/3 pl-[5px]" *ngIf="record?.status == 'New'">
                                    <mat-form-field class="w-[202px] pl-1 pr-4">
                                        <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Preferred
                                            Language</mat-label>
                                        <mat-select formControlName="preferred_language">
                                            <mat-option *ngFor="let lt of languageList"
                                                [value]="lt.value">{{lt.viewValue}}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="formGroup.get('preferred_language').hasError('required')">
                                            Preferred Language required
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <div class="w-1/3" [ngClass]="(record?.status === 'New' || record?.status === 'Active') ? 'pl-[7px]' : ''" *ngIf="record?.status == 'New' || record?.status == 'Active'">
                                    <mat-form-field class="w-[202px] pr-3">
                                        <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Review</mat-label>
                                        <mat-select formControlName="feedback">
                                            <mat-option *ngFor="let lt of feedbackList" [value]="lt.value">{{
                                                lt.viewValue}}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="formGroup.get('feedback').hasError('required')">
                                            Review is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <div class="w-1/3" [ngClass]="record?.status === 'Inactive' ? 'pl-[9px]' : ''" *ngIf="record?.status == 'Inactive'">
                                    <mat-form-field class="w-[190px]">
                                        <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">ReActive</mat-label>
                                        <mat-select formControlName="reactive_status">
                                            <mat-option *ngFor="let lt of reActiveList" [value]="lt.value">{{
                                                lt.viewValue}}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="formGroup.get('reactive_status').hasError('required')">
                                            ReActive is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <div class="w-1/3" *ngIf="record?.status == 'Inactive'">
                                    <mat-form-field class="w-[170px]">
                                        <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Reason</mat-label>
                                        <mat-select formControlName="reactive_reason">
                                            <mat-option *ngFor="let lt of reasonList" [value]="lt.value">{{
                                                lt.viewValue}}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="formGroup.get('reactive_reason').hasError('required')">
                                            Reason is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>

                                <!-- <div class="w-1/3" *ngIf="record?.status == 'New'">
                                    <mat-form-field class="w-[201px]">
                                        <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Service Offered By
                                            TA</mat-label>
                                        <mat-select [formControl]="service_offered_by_ta" multiple required>
                                            <mat-option *ngFor="let so of serviceOfferList" [value]="so">{{ so }}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="service_offered_by_ta.hasError('required')">Service Offered is required</mat-error>
                                    </mat-form-field>
                                </div> -->
                                <div class="w-1/3" *ngIf="record?.status == 'New'">
                                    <mat-form-field class="w-[201px]">
                                        <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Service Offered By TA</mat-label>
                                        <mat-select formControlName="service_offered_by_ta" multiple required>
                                            <mat-option *ngFor="let so of serviceOfferList" [value]="so">{{ so }}</mat-option>
                                        </mat-select>
                                        <mat-error *ngIf="formGroup.get('service_offered_by_ta').hasError('required')">
                                            Service Offered is required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-row px-[9px]">
                            <mat-form-field class="flex-grow">
                                <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Remark</mat-label>
                                <textarea matInput rows="4" formControlName="rm_remark"></textarea>
                                <mat-error *ngIf="formGroup.get('rm_remark').hasError('required')">
                                    Remark is required
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="flex flex-row">
                            <mat-checkbox formControlName="is_call_rescheduled">
                                <div class="text-base dark:text-white text-black relative"><span>Reschedule</span></div>
                            </mat-checkbox>
                        </div>
                    </div>
                    <div class="px-[10px] pt-1" *ngIf="this.formGroup.get('is_call_rescheduled').value == true">
                        <div class="flex flex-row w-full">
                            <div class="w-[70%]">
                                <!-- <mat-form-field class="w-[400px]">
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Assign</mat-label>
                                    <mat-select formControlName="call_assign_to">
                                        <mat-option *ngFor="let lt of dataList" [value]="lt.id">{{
                                            lt.employee_name}}</mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="formGroup.get('call_assign_to').hasError('required')">
                                        Assign is required
                                    </mat-error>
                                </mat-form-field> -->
                                <mat-form-field class="w-[400px]">
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Assign</mat-label>
                                    <mat-select formControlName="call_assign_to">
                                        <mat-option>
                                            <ngx-mat-select-search placeholderLabel="Search"
                                                noEntriesFoundLabel="'no matching agent found'" [formControlName]="'assignfilter'">
                                            </ngx-mat-select-search>
                                        </mat-option>
                                        <mat-option *ngFor="let lt of dataList" [value]="lt.id">
                                            <span>{{ lt.employee_name }}</span>
                                            <div class="-mt-2">
                                                <span class="text-secondary text-sm">{{lt.personal_email}}</span>
                                            </div>
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="w-[30%]">
                                <mat-form-field class="flex-grow w-[180px]">
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Priority</mat-label>
                                    <mat-select formControlName="priority">
                                        <mat-option *ngFor="let lt of priorityList" [value]="lt.value">{{ lt.viewValue
                                            }}</mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="formGroup.get('priority').hasError('required')">
                                        Priority is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>

                        <div class="flex flex-row w-full">
                            <div class="flex flex-row">
                                <mat-form-field class="flex-grow w-[205px] pr-1">
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Date</mat-label>
                                    <input matInput [readonly]="readonly" [matDatepicker]="joiningpicker"
                                        [min]="todayDateTime" placeholder="Choose a date"
                                        formControlName="schedule_date" />
                                    <mat-datepicker-toggle matSuffix [for]="joiningpicker"></mat-datepicker-toggle>
                                    <mat-datepicker #joiningpicker></mat-datepicker>
                                    <mat-error *ngIf="formGroup.get('schedule_date').hasError('required')">
                                        Date is required
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field class="flex-grow w-[205px] pl-2 pr-3">
                                    <ngx-mat-timepicker color="primary" #entryPicker></ngx-mat-timepicker>
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Time</mat-label>
                                    <input matInput [readonly]="readonly" format="24" formControlName="schedule_time"
                                        [ngxMatTimepicker]="entryPicker" readonly />
                                    <mat-icon matSuffix (click)="entryPicker.open()">
                                        watch_later
                                    </mat-icon>
                                    <mat-error *ngIf="formGroup.get('schedule_time').hasError('required')">
                                        Time is required
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field class="flex-grow w-[180px]">
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Purpose</mat-label>
                                    <mat-select formControlName="call_purpose">
                                        <mat-option *ngFor="let lt of purposeList" [value]="lt.value">{{ lt.viewValue
                                            }}</mat-option>
                                    </mat-select>
                                    <mat-error *ngIf="formGroup.get('call_purpose').hasError('required')">
                                        Purpose is required
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                        <div class="w-full">
                            <div class="flex flex-row">
                                <mat-form-field class="flex-grow">
                                    <mat-label class="text-base text-secondary font-medium dark:text-[#687798]">Remark</mat-label>
                                    <textarea matInput rows="3" formControlName="reschedule_remark"></textarea>
                                </mat-form-field>
                            </div>
                            <mat-error *ngIf="formGroup.get('reschedule_remark').hasError('required') && (formGroup.get('reschedule_remark').dirty || formGroup.get('reschedule_remark').touched)" class="mt-[-18px]">
                                <span class="text-[12px] font-medium">Remark is required</span>
                            </mat-error>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div *ngIf="!readonly" class="flex items-center justify-end mt-4 sm:mt-1 pr-6 py-3 space-x-3">
        <button mat-stroked-button (click)="matDialogRef.close()"> Close </button>
        <button *ngIf="!readonly" mat-flat-button [color]="'primary'" (click)="submit()" [disabled]="disableBtn">
            {{btnLabel}}
        </button>
    </div>
</div>
