<div class="flex flex-col gap-5">
    <div class="flex justify-center items-center gap-8">
        <ng-container *ngFor="let step of stepArr; let i = index">
            <div class="flex items-center gap-3">
                <!-- Step Circle -->
                <div class="w-8 h-8 flex items-center justify-center rounded-full border" [ngClass]="{
                    'text-white bg-[#0D9488] border-[#0D9488]': step.isCompleted && !step.isActive,
                    'dark:text-white dark:border-white': step.isActive && !step.isCompleted,
                    'dark:text-[#687798] dark:border-[#687798]': !step.isActive && !step.isCompleted
                  }">
                    <ng-container *ngIf="!step.isCompleted; else completedIcon">{{ i + 1 }}</ng-container>
                    <ng-template #completedIcon>
                        <i class="material-icons">done</i>
                    </ng-template>
                </div>

                <!-- Step Label -->
                <div [ngClass]="{
                    'dark:text-white': step.isActive,
                    'text-[#0D9488]': step.isCompleted,
                    'dark:text-[#687798]': !step.isActive && !step.isCompleted
                  }">
                    {{ step.label }}
                </div>
            </div>

            <!-- Step Divider -->
            <div *ngIf="i !== stepArr.length - 1" class="w-8 border" [ngClass]="{
                  'dark:border-white': step.isActive,
                  'border-[#0D9488]': step.isCompleted,
                  'dark:border-[#687798]': !step.isActive && !step.isCompleted
                }">
            </div>
        </ng-container>
    </div>

    <div [ngSwitch]="currentStep">
        <!-- Step 1 -->
        <div *ngSwitchCase="1">
            <h2 class="text-2xl font-semibold mb-4 font-Inter">Set-up for enable 2FA</h2>
            <p class="mb-4 font-Inter font-normal text-lg text-[#000000] dark:text-[#879FC1]">Start by entering your
                password so
                that we
                know it's you. Then we'll walk through two more
                simple steps.</p>
            <p class="mb-4 font-Inter font-normal text-lg text-[#000000] dark:text-[#879FC1]">When you enable two-step
                verification, we keep
                you logged in to this device. We may
                log you out from your other devices, to log back in, enter your password and complete the second
                verification step.</p>
            <div class="mb-4 w-[280px]">
                <label for="password" class="font-Inter text-lg text-[#8F8F8F] dark:text-[#E5E1E1]">
                    Enter portal password<span class="text-red-500">*</span>
                </label>
                <form [formGroup]="twoFaFormGroup" novalidate>
                    <!-- <div class="mt-1 flex flex-col text-xl"> -->
                    <mat-form-field class="w-full" [ngClass]="twoFaFormGroup.get('enablePassword').hasError('required') && twoFaFormGroup.get('enablePassword').touched ?
            'border-red-500' : 'border-[#CECECE]'">
                        <input id="password" matInput type="password" required formControlName="enablePassword" class=""
                            #passwordField>
                        <button mat-icon-button class="" type="button"
                            (click)="passwordField.type === 'password' ? passwordField.type = 'text' : passwordField.type = 'password'"
                            matSuffix>
                            <mat-icon class="icon-size-5 text-[#324154]" *ngIf="passwordField.type === 'password'"
                                [svgIcon]="'heroicons_solid:eye'"></mat-icon>
                            <mat-icon class="icon-size-5 text-[#324154]" *ngIf="passwordField.type === 'text'"
                                [svgIcon]="'heroicons_solid:eye-slash'"></mat-icon>
                        </button>
                    </mat-form-field>
                    <mat-error class="pt-[6pex]"
                        *ngIf="twoFaFormGroup.get('enablePassword').hasError('required') && twoFaFormGroup.get('enablePassword').touched">
                        <span class="text-red-600 text-sm">Password is required</span>
                    </mat-error>
                    <!-- </div> -->
                </form>
            </div>
            <div class="text-end">
                <button type="button" (click)="matDialogRef.close()"
                    class="border text-[15px] rounded-[18px] dark:border-[#324154] w-[140px] mr-3 py-2">
                    Close
                </button>
                <button type="submit" class="text-[15px] py-2 rounded-[18px] dark:bg-[#0D9488] w-[140px]"
                    (click)="authEnableStep()" [disabled]="!twoFaFormGroup.get('enablePassword').value">
                    Verify Now
                </button>
            </div>
        </div>

        <!-- Step 2 -->
        <div *ngSwitchCase="2">
            <h2 class="text-3xl font-semibold mb-3 mt-6 font-Inter">Enable 2FA</h2>
            <div class="flex flex-raw">
                <ol class="list-decimal list-inside">
                    <li class="mb-2 font-Inter font-medium text-xl">You will need an authenticator mobile ap to complete
                        this process, such as,
                        <div class="text-[#4A8ED2] font-Inter font-medium text-xl">
                            Microsoft Authenticator, Google Authenticator, Duo Mobile, Authenticator 7
                        </div>
                    </li>
                </ol>
                <div class="flex justify-center pl-3">
                    <img [src]="transformQr" alt="QR Code" class="max-w-32" />
                </div>
            </div>
            <p class="mb-2 font-Inter font-medium text-xl">2. Scan the QR code with your authenticator</p>
            <p class="mb-2 text-base font-Inter font-medium">If you can't scan the code, you can enter this secret key
                into your authentication
                app.</p>
            <div class="mb-4 flex items-center">
                <input type="text" [value]="twoFactorEnabledList?.key" class="flex-grow p-2 border rounded-l-md"
                    readonly>
                <button class="bg-gray-200 p-2 rounded-r-md h-[39px]">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                        (click)="twoFactorCopyLink(twoFactorEnabledList?.key)" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                        </path>
                    </svg>
                </button>
            </div>
            <p class="mb-2 font-Inter font-medium text-xl">3. After scanning the QR code above, enter the six-digit code
                generated by your authenticator</p>

            <ng-otp-input #ngOtpInput (onInputChange)="onOtpChange($event)" [config]="twoFaAuthenticationService.otpConfig"></ng-otp-input>

            <div class="flex justify-end">
                <button
                    class="px-7 py-2 text-[#55595D] rounded-md text-xl mr-6 border-2 border-[#CECECE] font-Inter font-semibold"
                    (click)="matDialogRef.close()">
                    Close
                </button>
                <button mat-flat-button class="px-7 py-2 primary-bg text-white rounded-md text-xl font-Inter font-semibold"
                    (click)="authConfigureNow('AuthApp')" [disabled]="authotp?.length < 6">
                    Configure now
                </button>
            </div>
        </div>

        <!-- Step 3 -->
        <div *ngSwitchCase="3">
            <h2 class="text-3xl font-semibold mb-3 mt-6 font-Inter">Keep these recovery codes safe</h2>
            <p class="mb-4 font-normal text-lg text-[#474747]">If you lose access to your authentication device, you can
                use one of these backup codes to
                log in your account. Each code can only be used once. Make a copy of these codes and keep it somewhere
                safe.</p>
            <div class="grid grid-cols-4 gap-1 mb-4 max-w-[770px]">
                <div *ngFor="let code of recoveryCodes; let i = index" class="p-2">
                    <div class="flex border-r" [ngClass]="{'border-r': (i + 1) % 4 !== 0}">
                        <span class="font-Inter font-semibold text-xl text-[#182B41B2]">{{code}}</span>
                        <mat-divider class="h-6 border-[#234977]"></mat-divider>
                    </div>
                </div>
            </div>
            <mat-divider></mat-divider>
            <div class="flex justify-end mb-4 mt-8">
                <!-- <button
                    class="px-4 py-2 bg-[#E8ECEF] primary-text rounded-md w-[150px] font-Inter font-semibold text-xl"
                    (click)="printCodes()">
                    Print Codes
                </button> -->
                <button
                    class="px-4 py-2 bg-[#E8ECEF] primary-text rounded-md w-[150px] font-Inter font-semibold text-xl ml-6"
                    (click)="copyCodes()">
                    Copy Codes
                </button>
            </div>
            <!-- <span class="font-Inter text-2xl font-semibold text-[#000000]">Save this key? Then finish it!</span>
            <button (click)="matDialogRef.close()"
                class="mt-3 w-full px-4 py-3 font-Inter text-lg font-semibold primary-bg text-white rounded-md">
                I have saved my codes
            </button> -->
        </div>
    </div>

</div>