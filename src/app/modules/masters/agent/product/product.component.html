<div>
    <div class="overflow-auto flex flex-col max-h-[80vh] rounded border ">
        <div class="flex flex-col overflow-auto max-w-full ">
            <table mat-table [dataSource]="dataSource" class="border-collapse sale-tab" matSort matSortDisableClear
                matSortDirection="desc" matSortActive="expiryDate" (matSortChange)="refreshItems()">

                <ng-container matColumnDef="options">
                    <th mat-header-cell class="font-bold text-md  min-w-12 max-w-12 w-15 text-center" *matHeaderCellDef>
                        #
                    </th>
                    <td mat-cell *matCellDef="let element"
                        class="border min-w-12 max-w-12 cursor-pointer text-center p-0">
                        <button mat-icon-button (click)="$event.stopPropagation()" [matMenuTriggerFor]="optionMenu"
                            class="sticky left-0 ">
                            <mat-icon> more_vert </mat-icon>
                        </button>
                        <mat-menu #optionMenu>
                            <button mat-menu-item (click)="info(element)">
                                <mat-icon class="mat-18">info</mat-icon>
                                <span style="font-weight: 600;">Info</span>
                            </button>

                            <button mat-menu-item (click)="editProduct(element)"
                                *ngIf="element.receiptStatus !== 'Confirmed'">
                                <mat-icon class="mat-18">edit</mat-icon>
                                <span style="font-weight: 600">Modify</span>
                            </button>

                            <button mat-menu-item (click)="cancelProduct(element)"
                                *ngIf="element.status == 'Delivered' || element.receiptStatus == 'Confirmed'">
                                <mat-icon class="mat-18">close</mat-icon>
                                <span style="font-weight: 600">Cancel</span>
                            </button>

                            <button mat-menu-item (click)="deleteProduct(element)"
                                *ngIf="element.receiptStatus !== 'Confirmed'">
                                <mat-icon class="mat-18">delete</mat-icon>
                                <span style="font-weight: 600">Delete</span>
                            </button>

                            <!-- *ngIf="element.receiptStatus == 'Confirmed' && element.status != 'Sales Return'" -->
                            <button mat-menu-item (click)="salesReturnProduct(element)" >
                                <mat-icon svgIcon="heroicons_outline:currency-rupee"></mat-icon>
                                <span style="font-weight: 600">Sales Return</span>
                            </button>

                            <button mat-menu-item (click)="expiryProduct(element)"
                                *ngIf="element.status == 'Delivered'">
                                <mat-icon svgIcon="mat_solid:history_toggle_off"></mat-icon>
                                <span style="font-weight: 600">Expiry</span>
                            </button>

                            <button mat-menu-item (click)="setBlockUnblock(element)">
                                <mat-icon class="mat-18 icon-size-5">{{element.isBlocked ? "highlight_off" :
                                    "check_circle"}}</mat-icon>
                                <span style="font-weight: 500">{{element.isBlocked ? "Unblock" : "Block"}}</span>
                            </button>

                            <button mat-menu-item (click)="shiftProduct(element)"
                                *ngIf="element.status == 'Delivered'">
                                <mat-icon svgIcon="heroicons_outline:arrows-right-left"></mat-icon>
                                <span style="font-weight: 600">Shift Product</span>
                            </button>
                        </mat-menu>
                    </td>
                </ng-container>

                <ng-container matColumnDef="productName">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-40 max-w-40" *matHeaderCellDef>
                        Product
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b truncate min-w-40 max-w-40"
                        [matTooltip]="element.productName">
                        {{element.productName || ' - '}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="itemCount">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-26 max-w-26" *matHeaderCellDef>
                        Items
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b truncate min-w-26 max-w-26 pl-[25px]">
                        {{element.itemCount ?? ' 0 '}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="installmentCount">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-26 max-w-26" *matHeaderCellDef>
                        Installments
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b truncate min-w-26 max-w-26 pl-[50px]">
                        {{element.installmentCount ?? ' 0 '}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-36 max-w-36" *matHeaderCellDef>
                        Status
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b truncate min-w-36 max-w-36"
                        [ngClass]="getStatusColor(element?.status)">
                        {{element.status || ' - '}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="purchasePrice">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-36 max-w-36 right-side-title"
                        *matHeaderCellDef>
                        Price
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-36 max-w-36 text-right">
                        <span [matTooltip]="element.purchasePrice" class="max-w-36 min-w-36 pr-[15px]">
                            {{ element?.purchasePrice != null ?(element.purchasePrice | currency: (element.currency
                            || 'INR') : 'symbol' : '1.2-2') : '-' }}
                        </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="dueAmount">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-36 max-w-36 right-side-title"
                        *matHeaderCellDef>
                        Due Amount
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b min-w-36 max-w-36 text-right">
                        <span [matTooltip]="element.dueAmount" class="max-w-36  min-w-36 pr-[15px]">
                            {{ element?.dueAmount != null ?(element.dueAmount | currency: (element.currency || 'INR')
                            : 'symbol' : '1.2-2') : '-' }}
                        </span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="startIntegration">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-40 max-w-40" *matHeaderCellDef>
                        Start Integration
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b truncate min-w-40 max-w-40 pl-[56px]">
                        <span [matTooltip]="element.startIntegration" [ngClass]="getStartIntegrationColor(element)"
                            class="max-w-40 truncate min-w-40">{{element.startIntegration ? 'Yes' : ' No '}}</span>
                    </td>
                </ng-container>

                <!-- <ng-container matColumnDef="acivation_date">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-40 max-w-40"
                        *matHeaderCellDef>
                        Activation Date
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b pt-1 min-w-40 max-w-40">
                        <p class="text-md font-medium truncate pr-1 leading-3" >{{ (element.acivation_date | date : "dd-MM-YYYY") || ' - '}}
                        </p>
                    </td>
                </ng-container>

                <ng-container matColumnDef="expiry_date">
                    <th mat-header-cell mat-sort-header class="font-bold text-md min-w-36 max-w-36"
                        *matHeaderCellDef>
                        Expiry Date
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b pt-1 min-w-36 max-w-36">
                        <p class="text-md font-medium truncate pr-1 leading-3" >{{ (element.expiry_date | date : "dd-MM-YYYY") || ' - '}}
                        </p>
                    </td>
                </ng-container> -->

                <ng-container matColumnDef="entryDate">
                    <th mat-header-cell mat-sort-header class="font-bold text-md w-full" *matHeaderCellDef>
                        Entry Date
                    </th>
                    <td mat-cell *matCellDef="let element" class="border-b pt-1 w-full">
                        <p class="text-md font-medium truncate pr-1 leading-3">{{ element.entryDate || ' - '}}
                        </p>
                    </td>
                </ng-container>


                <tr class="h-9 min-h-9 sticky top-0 z-10" mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
                <tr class="h-9 border-0" mat-row *matRowDef="let row; columns: columns"></tr>
            </table>
        </div>
        <div class="flex flex-col justify-center items-center w-full h-80" *ngIf=" dataSource.data.length <= 0">
            <div class="flex flex-row items-center space-x-4" *ngIf="loading">
                <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
                <span class="text-xl">Loading...</span>
            </div>
            <div class="flex flex-col items-center justify-center" *ngIf="!loading">
                <p>No data to display!</p>
                <div class="text-secondary flex flex-col justify-center items-center text-md"
                    *ngIf="searchInputControl.value">
                    <span>no search results found for "<b>{{searchInputControl.value}}</b>".</span>
                </div>
            </div>
        </div>
        <mat-paginator class="second-color z-10 sticky w-full bottom-0 " #paginator [pageSizeOptions]="[5, 10, 25, 100]"
            [pageSize]="10" (page)="refreshItems()" showFirstLastButtons>
        </mat-paginator>
    </div>
</div>
<purchase-product-entry-settings></purchase-product-entry-settings>
<app-crm-sales-return-right></app-crm-sales-return-right>